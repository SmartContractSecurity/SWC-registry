
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Smart Contract Weakness Classification and Test Cases">
      
      
        <meta name="author" content="Dominik Muhs">
      
      
        <link rel="canonical" href="https://swcregistry.io/docs/SWC-105/">
      
      
        <link rel="prev" href="../SWC-104/">
      
      
        <link rel="next" href="../SWC-106/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>SWC-105 - Smart Contract Weakness Classification (SWC)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#please-note-this-content-is-no-longer-actively-maintained" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Smart Contract Weakness Classification (SWC)" class="md-header__button md-logo" aria-label="Smart Contract Weakness Classification (SWC)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Smart Contract Weakness Classification (SWC)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SWC-105
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/SmartContractSecurity/SWC-registry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SWC Registry
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Smart Contract Weakness Classification (SWC)" class="md-nav__button md-logo" aria-label="Smart Contract Weakness Classification (SWC)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Smart Contract Weakness Classification (SWC)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SmartContractSecurity/SWC-registry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SWC Registry
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-100/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-100
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-101
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-102/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-102
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-103/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-103
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-104/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-104
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    SWC-105
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-106/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-106
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-107/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-107
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-108/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-108
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-109/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-109
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-110/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-110
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-111/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-111
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-112/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-112
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-113/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-113
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-114/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-114
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-115/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-115
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-116/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-116
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-117/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-117
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-118/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-118
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-119/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-119
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-120/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-120
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-121/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-121
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-122/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-122
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-123/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-123
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-124/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-124
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-125/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-125
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-126/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-126
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-127/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-127
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-128/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-128
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-129/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-129
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-130/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-130
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-131/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-131
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-132/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-132
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-133/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-133
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-134/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-134
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-135/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-135
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SWC-136/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SWC-136
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="please-note-this-content-is-no-longer-actively-maintained">Please note, this content is no longer actively maintained.</h1>
<p>The content of the SWC registry has not been thoroughly updated since 2020. It is known to be incomplete and may contain errors as well as crucial omissions.</p>
<p>For currently maintained guidance on known Smart Contract vulnerabilities written primarily as guidance for security reviewers, please see the
<a href="https://entethalliance.org/specs/ethtrust-sl">EEA EthTrust Security Levels specification</a>. As well as the latest release version, an
<a href="https://entethalliance.github.io/eta-registry/security-levels-spec.html">Editor's draft</a> is available,
that represents the latest work of the group developing the specification.</p>
<p>General guidance for developers on what to consider to ensure security, that is currently maintained, is also available through the
<a href="https://github.com/ComposableSecurity/SCSVS">Smart Contract Security Verification Standard (SCSVS)</a>.</p>
<h1 id="title">Title</h1>
<p>Unprotected Ether Withdrawal</p>
<h2 id="relationships">Relationships</h2>
<ul>
<li><a href="https://cwe.mitre.org/data/definitions/284.html">CWE-284: Improper Access Control</a></li>
<li>EthTrust Security Levels:</li>
<li><a href="https://entethalliance.github.io/eta-registry/security-levels-spec.html#req-2-self-destruct"><strong>[M] Protect Self-destruction</strong></a></li>
<li><a href="https://entethalliance.github.io/eta-registry/security-levels-spec.html#req-3-access-control"><strong>[Q] Enforce Least Privilege</strong></a></li>
</ul>
<h2 id="description">Description</h2>
<p>Due to missing or insufficient access controls, malicious parties can withdraw some or all Ether from the contract account.</p>
<p>This bug is sometimes caused by unintentionally exposing initialization functions. By wrongly naming a function intended to be a constructor, the constructor code ends up in the runtime byte code and can be called by anyone to re-initialize the contract.</p>
<h2 id="remediation">Remediation</h2>
<p>Implement controls so withdrawals can only be triggered by authorized parties or according to the specs of the smart contract system.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://etherscan.io/address/0xe82719202e5965Cf5D9B6673B7503a3b92DE20be#code">Rubixi smart contract</a></li>
</ul>
<h2 id="samples">Samples</h2>
<h3 id="tokensalechallengesol">tokensalechallenge.sol</h3>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> * @source: https://capturetheether.com/challenges/math/token-sale/</span>
<span class="cm"> * @author: Steve Marx</span>
<span class="cm"> */</span>

<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.21</span><span class="p">;</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TokenSaleChallenge</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>balanceOf<span class="p">;</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>PRICE_PER_TOKEN<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">TokenSaleChallenge</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_player</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">isComplete</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">buy</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">numTokens</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>numTokens<span class="w"> </span><span class="o">*</span><span class="w"> </span>PRICE_PER_TOKEN<span class="p">);</span>

<span class="w">        </span>balanceOf<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>numTokens<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sell</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">numTokens</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>balanceOf<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>numTokens<span class="p">);</span>

<span class="w">        </span>balanceOf<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>numTokens<span class="p">;</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>numTokens<span class="w"> </span><span class="o">*</span><span class="w"> </span>PRICE_PER_TOKEN<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="rubixisol">rubixi.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.22</span><span class="p">;</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Rubixi</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">//Declare variables for storage critical to contract</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">collectedFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">feePercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">pyramidMultiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">300</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">payoutOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>

<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="k">private </span><span class="nv">creator</span><span class="p">;</span>

<span class="w">        </span><span class="c1">//Sets creator</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">DynamicPyramid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">modifier</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>creator<span class="p">)</span><span class="w"> </span>_<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Participant</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">address</span><span class="w"> </span><span class="nv">etherAddress</span><span class="p">;</span>
<span class="w">                </span><span class="kt">uint</span><span class="w"> </span><span class="nv">payout</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>Participant<span class="p">[]</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>participants<span class="p">;</span>

<span class="w">        </span><span class="c1">//Fallback function</span>
<span class="w">        </span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>init<span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//init function run on fallback</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">init</span><span class="p">()</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">//Ensures only tx with value of 1 ether or greater are processed and added to pyramid</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span>collectedFees<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span>
<span class="w">                        </span><span class="kt">return</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="kt">uint</span><span class="w"> </span><span class="nv">_fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>feePercent<span class="p">;</span>
<span class="w">                </span><span class="c1">//50% fee rebate on any ether value of 50 or greater</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span>ether<span class="p">)</span><span class="w"> </span>_fee<span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span>

<span class="w">                </span>addPayout<span class="p">(</span>_fee<span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//Function called for valid tx to the contract</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">addPayout</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">_fee</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">//Adds new address to participant array</span>
<span class="w">                </span>participants<span class="p">.</span>push<span class="p">(</span>Participant<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>pyramidMultiplier<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">));</span>

<span class="w">                </span><span class="c1">//These statements ensure a quicker payout system to later pyramid entrants, so the pyramid has a longer lifespan</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>participants<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span>pyramidMultiplier<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">200</span><span class="p">;</span>
<span class="w">                </span><span class="kt">else</span><span class="w"> </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>participants<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">25</span><span class="p">)</span><span class="w"> </span>pyramidMultiplier<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">150</span><span class="p">;</span>

<span class="w">                </span><span class="c1">// collect fees and update contract balance</span>
<span class="w">                </span>balance<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>_fee<span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">;</span>
<span class="w">                </span>collectedFees<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>_fee<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">;</span>

<span class="w">                </span><span class="c1">//Pays earlier participiants if balance sufficient</span>
<span class="w">                </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>balance<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>participants<span class="p">[</span>payoutOrder<span class="p">].</span>payout<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">payoutToSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">[</span>payoutOrder<span class="p">].</span>payout<span class="p">;</span>
<span class="w">                        </span>participants<span class="p">[</span>payoutOrder<span class="p">].</span>etherAddress<span class="p">.</span>send<span class="p">(</span>payoutToSend<span class="p">);</span>

<span class="w">                        </span>balance<span class="w"> </span><span class="o">-=</span><span class="w"> </span>participants<span class="p">[</span>payoutOrder<span class="p">].</span>payout<span class="p">;</span>
<span class="w">                        </span>payoutOrder<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//Fee functions for creator</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">collectAllFees</span><span class="p">()</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>collectedFees<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="kt">throw</span><span class="p">;</span>

<span class="w">                </span>creator<span class="p">.</span>send<span class="p">(</span>collectedFees<span class="p">);</span>
<span class="w">                </span>collectedFees<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">collectFeesInEther</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">_amt</span><span class="p">)</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span>_amt<span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>_amt<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>collectedFees<span class="p">)</span><span class="w"> </span>collectAllFees<span class="p">();</span>

<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>collectedFees<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="kt">throw</span><span class="p">;</span>

<span class="w">                </span>creator<span class="p">.</span>send<span class="p">(</span>_amt<span class="p">);</span>
<span class="w">                </span>collectedFees<span class="w"> </span><span class="o">-=</span><span class="w"> </span>_amt<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">collectPercentOfFees</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">_pcent</span><span class="p">)</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>collectedFees<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>_pcent<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">)</span><span class="w"> </span><span class="kt">throw</span><span class="p">;</span>

<span class="w">                </span><span class="kt">uint</span><span class="w"> </span><span class="nv">feesToCollect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>collectedFees<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>_pcent<span class="p">;</span>
<span class="w">                </span>creator<span class="p">.</span>send<span class="p">(</span>feesToCollect<span class="p">);</span>
<span class="w">                </span>collectedFees<span class="w"> </span><span class="o">-=</span><span class="w"> </span>feesToCollect<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//Functions for changing variables related to the contract</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_owner</span><span class="p">)</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span>_owner<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeMultiplier</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">_mult</span><span class="p">)</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>_mult<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">300</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>_mult<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">120</span><span class="p">)</span><span class="w"> </span><span class="kt">throw</span><span class="p">;</span>

<span class="w">                </span>pyramidMultiplier<span class="w"> </span><span class="o">=</span><span class="w"> </span>_mult<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeFeePercentage</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">_fee</span><span class="p">)</span><span class="w"> </span>onlyowner<span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>_fee<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span><span class="kt">throw</span><span class="p">;</span>

<span class="w">                </span>feePercent<span class="w"> </span><span class="o">=</span><span class="w"> </span>_fee<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//Functions to provide information to end-user using JSON interface or other interfaces</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">currentMultiplier</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">multiplier</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>multiplier<span class="w"> </span><span class="o">=</span><span class="w"> </span>pyramidMultiplier<span class="p">;</span>
<span class="w">                </span>info<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;This multiplier applies to you as soon as transaction is received, may be lowered to hasten payouts or increased if payouts are fast enough. Due to no float or decimals, multiplier is x100 for a fractional multiplier e.g. 250 is actually a 2.5x multiplier. Capped at 3x max and 1.2x min.&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">currentFeePercentage</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">fee</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>fee<span class="w"> </span><span class="o">=</span><span class="w"> </span>feePercent<span class="p">;</span>
<span class="w">                </span>info<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Shown in % form. Fee is halved(50%) for amounts equal or greater than 50 ethers. (Fee may change, but is capped to a maximum of 10%)&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">currentPyramidBalanceApproximately</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">pyramidBalance</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>pyramidBalance<span class="w"> </span><span class="o">=</span><span class="w"> </span>balance<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">                </span>info<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;All balance values are measured in Ethers, note that due to no decimal placing, these values show up as integers only, within the contract itself you will get the exact decimal value you are supposed to&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">nextPayoutWhenPyramidBalanceTotalsApproximately</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">balancePayout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>balancePayout<span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">[</span>payoutOrder<span class="p">].</span>payout<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">feesSeperateFromBalanceApproximately</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">fees</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>fees<span class="w"> </span><span class="o">=</span><span class="w"> </span>collectedFees<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">totalParticipants</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>count<span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">.</span>length<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">numberOfParticipantsWaitingForPayout</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span>count<span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">.</span>length<span class="w"> </span><span class="o">-</span><span class="w"> </span>payoutOrder<span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">participantDetails</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">orderInPyramid</span><span class="p">)</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">Address</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">Payout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>orderInPyramid<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>participants<span class="p">.</span>length<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span>Address<span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">[</span>orderInPyramid<span class="p">].</span>etherAddress<span class="p">;</span>
<span class="w">                        </span>Payout<span class="w"> </span><span class="o">=</span><span class="w"> </span>participants<span class="p">[</span>orderInPyramid<span class="p">].</span>payout<span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="multiowned_not_vulnerablesol">multiowned_not_vulnerable.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.23</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * @title MultiOwnable</span>
<span class="cm"> */</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">MultiOwnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">root</span><span class="p">;</span>
<span class="w">  </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>owners<span class="p">;</span><span class="w"> </span><span class="c1">// owner =&gt; parent of owner</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span>
<span class="cm">  * account.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>root<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span>owners<span class="p">[</span>root<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>root<span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev Throws if called by any account other than the owner.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>owners<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span>
<span class="w">    </span>_<span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev Adding new owners</span>
<span class="cm">  * Note that the &quot;onlyOwner&quot; modifier is used here.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_owner</span><span class="p">)</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>_owner<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span>
<span class="w">    </span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">    * @dev Deleting owners</span>
<span class="cm">    */</span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">deleteOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_owner</span><span class="p">)</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>root<span class="p">));</span>
<span class="w">    </span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TestContract</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>MultiOwnable<span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdrawAll</span><span class="p">()</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="multiowned_vulnerablesol">multiowned_vulnerable.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.23</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * @title MultiOwnable</span>
<span class="cm"> */</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">MultiOwnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">root</span><span class="p">;</span>
<span class="w">  </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>owners<span class="p">;</span><span class="w"> </span><span class="c1">// owner =&gt; parent of owner</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span>
<span class="cm">  * account.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>root<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span>owners<span class="p">[</span>root<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>root<span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev Throws if called by any account other than the owner.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>owners<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span>
<span class="w">    </span>_<span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">  * @dev Adding new owners</span>
<span class="cm">  * Note that the &quot;onlyOwner&quot; modifier is missing here.</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_owner</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>_owner<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span>
<span class="w">    </span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">    * @dev Deleting owners</span>
<span class="cm">    */</span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">deleteOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_owner</span><span class="p">)</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>root<span class="p">));</span>
<span class="w">    </span>owners<span class="p">[</span>_owner<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TestContract</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>MultiOwnable<span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdrawAll</span><span class="p">()</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="simple_ether_drainsol">simple_ether_drain.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.22</span><span class="p">;</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleEtherDrain</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdrawAllAnyone</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="wallet_01_oksol">wallet_01_ok.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.24</span><span class="p">;</span>

<span class="cm">/* User can add pay in and withdraw Ether.</span>
<span class="cm">   Nobody can withdraw more Ether than they paid in.</span>
<span class="cm">*/</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Wallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">creator</span><span class="p">;</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>assert<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>amount<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">refund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// In an emergency the owner can migrate  allfunds to a different address.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">migrateTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>creator<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">        </span>to<span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="wallet_02_refund_nosubsol">wallet_02_refund_nosub.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.24</span><span class="p">;</span>

<span class="cm">/* User can add pay in and withdraw Ether.</span>
<span class="cm">   Unfortunately the developer forgot set the user&#39;s balance to 0 when refund() is called.</span>
<span class="cm">   An attacker can pay in a small amount of Ether and call refund() repeatedly to empty the contract.</span>
<span class="cm">*/</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Wallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">creator</span><span class="p">;</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>assert<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>amount<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">refund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// In an emergency the owner can migrate  allfunds to a different address.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">migrateTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>creator<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">        </span>to<span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="wallet_03_wrong_constructorsol">wallet_03_wrong_constructor.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.24</span><span class="p">;</span>

<span class="cm">/* User can add pay in and withdraw Ether.</span>
<span class="cm">   The constructor is wrongly named, so anyone can become &#39;creator&#39; and withdraw all funds.</span>
<span class="cm">*/</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Wallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">creator</span><span class="p">;</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">initWallet</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>assert<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>amount<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// In an emergency the owner can migrate  allfunds to a different address.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">migrateTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>creator<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">        </span>to<span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="wallet_04_confused_signsol">wallet_04_confused_sign.sol</h3>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.24</span><span class="p">;</span>

<span class="cm">/* User can add pay in and withdraw Ether.</span>
<span class="cm">   Unfortunately, the developer was drunk and used the wrong comparison operator in &quot;withdraw()&quot;</span>
<span class="cm">   Anybody can withdraw arbitrary amounts of Ether :()</span>
<span class="cm">*/</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Wallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">creator</span><span class="p">;</span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>assert<span class="p">(</span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]);</span>
<span class="w">        </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// In an emergency the owner can migrate  allfunds to a different address.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">migrateTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>creator<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">        </span>to<span class="p">.</span>transfer<span class="p">(</span><span class="kt">this</span><span class="p">.</span>balance<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>